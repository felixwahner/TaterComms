plugins {
    id("com.github.johnrengelman.shadow") version("7.1.2")
}

dependencies {
    // YAML
    implementation("dev.dejvokep:boosted-yaml:1.3")

    // MySQL
    implementation("com.zaxxer:HikariCP:4.0.3")
    implementation("mysql:mysql-connector-java:8.0.26")

    // MongoDB
    implementation("org.mongodb:mongodb-driver-sync:4.9.1")

    // JDA
    implementation("net.dv8tion:JDA:5.0.0-beta.10") {
        exclude(module: "opus-java")
    }

    // Websocket
    implementation("com.neovisionaries:nv-websocket-client:2.14")

    // Logging
    compileOnly("org.slf4j:slf4j-api:2.0.5")
}

shadowJar {
    dependencies {
//        exclude(dependency("org.slf4j:slf4j-api:1.7.36"))

        // Feck it -- include all dependencies, I give up for now
//        // YAML
//        include(dependency("dev.dejvokep:boosted-yaml:1.3"))
//
//        // MySQL
//        include(dependency("com.zaxxer:HikariCP:4.0.3"))
//        include(dependency("mysql:mysql-connector-java:8.0.26"))
//
//        // MongoDB
//        include(dependency("org.mongodb:mongodb-driver-sync:4.9.1"))
//        include(dependency("org.mongodb:mongodb-driver-core:4.9.1"))
//        include(dependency("org.mongodb:bson:4.9.1"))
//
//        // JDA -- include nested dependencies
//        include(dependency("net.dv8tion:JDA:5.0.0-beta.10"))
//
//        // Websocket
//        include(dependency("com.neovisionaries:nv-websocket-client:2.14"))
    }
//    // YAML
//    relocate("dev.dejvokep", "ca.sperrer.p0t4t0sandwich.tatercomms.lib.dejvokep")
//
//    // MySQL
//    relocate("com.zaxxer.hikari", "ca.sperrer.p0t4t0sandwich.tatercomms.lib.hikari")
//    relocate("com.mysql", "ca.sperrer.p0t4t0sandwich.tatercomms.lib.mysql")
//
//    // MongoDB
//    relocate("com.mongodb", "ca.sperrer.p0t4t0sandwich.tatercomms.lib.mongodb")
//    relocate("org.bson", "ca.sperrer.p0t4t0sandwich.tatercomms.lib.bson")
//
//    // JDA
//    relocate("net.dv8tion", "ca.sperrer.p0t4t0sandwich.tatercomms.lib.dv8tion")
//    relocate("org.apache", "ca.sperrer.p0t4t0sandwich.tatercomms.lib.apache")
//    relocate("okhttp3", "ca.sperrer.p0t4t0sandwich.tatercomms.lib.okhttp3")
//    relocate("com.iwebpp", "ca.sperrer.p0t4t0sandwich.tatercomms.lib.iwebpp")
//    relocate("kotlin", "ca.sperrer.p0t4t0sandwich.tatercomms.lib.kotlin")
//    relocate("com.fasterxml.jackson", "ca.sperrer.p0t4t0sandwich.tatercomms.lib.jackson")
//    relocate("gnu.trove", "ca.sperrer.p0t4t0sandwich.tatercomms.lib.trove")
//    relocate("okio", "ca.sperrer.p0t4t0sandwich.tatercomms.lib.okio")
//
//    // Websocket
//    relocate("com.neovisionaries", "ca.sperrer.p0t4t0sandwich.tatercomms.lib.neovisionaries")

    destinationDir(file("../target"))
    archiveName("TaterComms-${version}-common.jar")
    classifier("")
}
shadowJar.doLast {
    task ->
        ant.checksum(file: task.archivePath) {
            hashAlgorithm = "md5"
            property = "md5sum"
        }
}

artifacts {
    archives(shadowJar)
}
